name: Benty Fields Daily Reminder

on:
  schedule:
    # 07:30 CET daily (06:30 UTC). GitHub cron uses UTC.
    - cron: "30 6 * * *"
  workflow_dispatch:
    inputs:
      recipient:
        description: "Optional test recipient email (overrides RECIPIENT_EMAIL secret for this run only)"
        required: false
        type: string

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - name: Build today's Benty URL
        id: benty
        run: |
          TODAY_CET="$(TZ='Europe/Paris' date +%F)"
          echo "today_cet=${TODAY_CET}" >> "$GITHUB_OUTPUT"
          echo "daily_url=https://www.benty-fields.com/daily_arXiv_results?date=${TODAY_CET}" >> "$GITHUB_OUTPUT"

      - name: Send reminder email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.GMAIL_USER }}
          password: ${{ secrets.GMAIL_PASSWORD }}
          subject: New papers are available!
          to: ${{ github.event.inputs.recipient || secrets.RECIPIENT_EMAIL }}
          from: Benty Reminder Bot <${{ secrets.GMAIL_USER }}>
          html_body: |
            <p>Hi Alexander,</p>
            <p>New papers are available for today (<strong>${{ steps.benty.outputs.today_cet }}</strong>).</p>
            <div style="margin: 20px 0;">
              <a href="${{ steps.benty.outputs.daily_url }}"
                 style="background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold;">
                 View Papers
              </a>
            </div>
            <p>Enjoy reading the newest publications.</p>
            <hr>
            <p style="font-size: 0.8em; color: grey;">
              This is your DIY Benty Fields notification via GitHub Actions.
            </p>
